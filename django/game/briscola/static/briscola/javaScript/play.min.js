function loadjscssfile(a,b){if("js"==b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",staticBegin+a+staticEnd)}else if("css"==b){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",staticBegin+a+staticEnd)}"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)}function getRandomInt(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a))+a}function BriscolaPlay(){this.deckSize=40,this.cardsPath="../static/briscola/media/pictures/slika",this.cardsLeft=this.deckSize,this.mixedCards=[];for(var a=0;a<this.deckSize;++a)this.mixedCards.push(a);this.cardPoints=[0,0,0,0,0,2,3,4,10,11],this.mixedCards.shuffle(),this.result=[0,0],this.myId=0,this.hisId=1,this.briscolaCard=-1,this.onTurn=!0,this.myTurn=0,this.mineCards=[-1,-1,-1],this.hisCards=[-1,-1,-1],this.cardsOnTable=[-1,-1]}staticBegin="/static/",staticEnd="",staticFilesPath=staticBegin+"briscola/",Array.prototype.shuffle=function(){for(var a=this.length;a;){var b=Math.floor(Math.random()*a--);[this[a],this[b]]=[this[b],this[a]]}return this},computerChose=function(){var a=briscolaPlay.hisCards.reduce(function(a,b,c){return b!==-1&&a.push(c),a},[]);return console.log(a),a[getRandomInt(0,a.length)]},playTurn=function(a,b){if("computer"!==a&&"player playCard"!==a)return void roundOverFunction();var c=document.getElementsByClassName("firstEmptySpace");if(!(void 0==c||c.length<1)){var d=document.getElementsByClassName(a),e=!1;b<0?(b=computerChose(),e=!0):(d=document.getElementsByClassName(a+" "+b),b=0),c[0].src=d[b].src;var f=parseInt(d[b].alt)-1;e?(c[0].name=briscolaPlay.hisCards[f],briscolaPlay.hisCards[f]=-1):(c[0].name=briscolaPlay.mineCards[f],briscolaPlay.mineCards[f]=-1),briscolaPlay.cardsOnTable[parseInt(c[0].alt)-1]=c[0].name,addClass(c[0],"thrown"),removeClass(c[0],"firstEmptySpace"),d[b].src="../static/briscola/media/pictures/pic.jpg",addClass(d[b],"addCard"),removeClass(d[b],"playCard")}},getCardFromTheDeckFor=function(a){var b=document.getElementsByClassName(a+" addCard");if(!(b.length<1)){b[0];b[0].src=briscolaPlay.cardsPath+briscolaPlay.mixedCards[briscolaPlay.deckSize-briscolaPlay.cardsLeft]+".jpg",hasClass(b[0],"player")?briscolaPlay.mineCards[parseInt(b[0].alt)-1]=briscolaPlay.mixedCards[briscolaPlay.deckSize-briscolaPlay.cardsLeft]:briscolaPlay.hisCards[parseInt(b[0].alt)-1]=briscolaPlay.mixedCards[briscolaPlay.deckSize-briscolaPlay.cardsLeft],briscolaPlay.setCardsLeft(briscolaPlay.cardsLeft-1),addClass(b[0],"playCard"),removeClass(b[0],"addCard")}},playCardEvent=function(a){a.preventDefault();var b=a.target;hasClass(b,"player")&&hasClass(b,"playCard")&&(briscolaPlay.onTurn?(playTurn("player playCard",parseInt(b.alt)),setTimeout(playTurn("computer",-1),1e3)):waitAbitPopup())},playCardEventWrapper=function(a){playCardEvent(a),setTimeout(sumCards(),6250),console.log(briscolaPlay.result)},deckCardPull=function(){if(!(briscolaPlay.cardsLeft<1)){if(briscolaPlay.onTurn?getCardFromTheDeckFor("player addCard"):getCardFromTheDeckFor("computer addCard"),1==briscolaPlay.cardsLeft)for(var a=document.getElementsByClassName("deckCard"),b=0;b<a.length;b++)a[b].src="../static/briscola/media/pictures/pic.jpg";if(briscolaPlay.onTurn?getCardFromTheDeckFor("computer addCard"):getCardFromTheDeckFor("player addCard"),0==briscolaPlay.cardsLeft){var c=document.getElementById("briscola");c.src="../static/briscola/media/pictures/pic.jpg"}}},sumeToMineResult=function(a){briscolaPlay.result[briscolaPlay.myId]+=a,briscolaPlay.onTurn=!0,briscolaPlay.myTurn=0},sumToHisResult=function(a){briscolaPlay.result[briscolaPlay.hisId]+=a,briscolaPlay.setOnTurn(!1),briscolaPlay.setMyTurn(1),setTimeout(function(){playTurn("computer",-1),briscolaPlay.setOnTurn(!0)},5e3)},removePlayCardsListeners=function(){for(var a=document.getElementsByClassName("playCard"),b=0;b<a.length;b++)a[b].removeEventListener("click",playCardEventWrapper,!1)},addPlayCardsListeners=function(){var a=document.getElementsByClassName("playCard");a.length<1&&roundOverFunction();for(var b=0;b<a.length;b++)a[b].addEventListener("click",playCardEventWrapper,!1)},sumCards=function(){var a=document.getElementsByClassName("thrown");if(2==a.length){for(var b=0;b<a.length/2;++b){var c=2*b+briscolaPlay.myTurn,d=2*b+Math.abs(1-briscolaPlay.myTurn),e=briscolaPlay.cardPoints[briscolaPlay.cardsOnTable[c]%10],f=Math.floor(briscolaPlay.cardsOnTable[c]/10),g=briscolaPlay.cardPoints[briscolaPlay.cardsOnTable[d]%10],h=Math.floor(briscolaPlay.cardsOnTable[d]/10);if(console.log(h),console.log(f),NaN===h||NaN===f||h<0||f<0)return void console.log("nije jos bacio");removePlayCardsListeners();var i=e+g;console.log("general "+i),0==briscolaPlay.myTurn&&f!=h&&h!=briscolaPlay.briscolaCard?(sumeToMineResult(i),console.log("typeMine != typeHis && typeHis != briscolaCard")):f==h?e>=g?(sumeToMineResult(i),console.log("typeMine == typeHis && mine >= his")):(console.log("typeMine == typeHis && mine < his"),sumToHisResult(i)):1==briscolaPlay.myTurn&&f==briscolaPlay.briscolaCard?sumeToMineResult(i):(console.log("ostalo"),sumToHisResult(i)),addClass(a[c],"firstEmptySpace"),briscolaPlay.cardsOnTable[parseInt(a[c].alt)-1]=-1,addClass(a[d],"firstEmptySpace"),briscolaPlay.cardsOnTable[parseInt(a[d].alt)-1]=-1}document.getElementsByClassName("minePoints")[0].innerHTML=briscolaPlay.result[briscolaPlay.myId],setTimeout(function(){deckCardPull(),addPlayCardsListeners();for(var a=document.getElementsByClassName("thrown");a.length>0;)a[0].src="../static/briscola/media/pictures/pic.jpg",a[0].removeAttribute("name"),briscolaPlay.cardsOnTable[parseInt(a[0].alt)-1]=-1,removeClass(a[0],"thrown")},1e3)}},roundOverFunction=function(){var a=user;briscolaPlay.result[briscolaPlay.myId]<briscolaPlay.result[briscolaPlay.hisId]&&(a="Computer"),briscolaPlay.result[briscolaPlay.myId]==briscolaPlay.result[briscolaPlay.hisId]&&(a=void 0),localStorage.clear(),localStorage.setItem("user",a),window.location="../roundOver/"+a.trim()},Storage.prototype.setObj=function(a,b){return this.setItem(a,JSON.stringify(b))},Storage.prototype.getObj=function(a){return JSON.parse(this.getItem(a))},BriscolaPlay.prototype={constructor:BriscolaPlay},BriscolaPlay.prototype.getDeckSize=function(){return this.deckSize},BriscolaPlay.prototype.setDeckSize=function(a){this.deckSize=a},BriscolaPlay.prototype.getCardPath=function(){return this.cardsPath},BriscolaPlay.prototype.setCardPath=function(a){this.cardsPath=a},BriscolaPlay.prototype.getCardsLeft=function(){return this.cardsLeft},BriscolaPlay.prototype.setCardsLeft=function(a){this.cardsLeft=a},BriscolaPlay.prototype.getMixedCards=function(){return this.mixedCards},BriscolaPlay.prototype.setMixedCards=function(a){this.mixedCards=a},BriscolaPlay.prototype.getCardPoints=function(){return this.cardPoints},BriscolaPlay.prototype.setCardPoints=function(a){this.cardPoints=a},BriscolaPlay.prototype.getResult=function(){return this.result},BriscolaPlay.prototype.setResult=function(a){this.result=a},BriscolaPlay.prototype.getMyId=function(){return this.myId},BriscolaPlay.prototype.setMyId=function(a){this.myId=a},BriscolaPlay.prototype.getHisId=function(){return this.hisId},BriscolaPlay.prototype.setHisId=function(a){this.hisId=a},BriscolaPlay.prototype.getBriscolaCard=function(){return this.briscolaCard},BriscolaPlay.prototype.setBriscolaCard=function(a){this.briscolaCard=a},BriscolaPlay.prototype.getOnTurn=function(){return this.onTurn},BriscolaPlay.prototype.setOnTurn=function(a){this.onTurn=a},BriscolaPlay.prototype.getMyTurn=function(){return this.myTurn},BriscolaPlay.prototype.setMyTurn=function(a){this.myTurn=a},BriscolaPlay.prototype.setJSON=function(a){a=JSON.parse(a),this.deckSize=a.deckSize,this.cardsPath=a.cardsPath,this.cardsLeft=a.cardsLeft,this.mixedCards=a.mixedCards,this.cardPoints=a.cardPoints,this.result=a.result,this.myId=a.myId,this.hisId=a.hisId,this.briscolaCard=a.briscolaCard,this.onTurn=a.onTurn,this.myTurn=a.myTurn,this.mineCards=a.mineCards,this.hisCards=a.hisCards,this.cardsOnTable=a.cardsOnTable},continueGame=function(){console.log(localStorage.getItem("start")),briscolaPlay.setJSON(localStorage.getItem("briscolaPlay")),console.log("hi cards "+briscolaPlay.hisCards),document.getElementsByClassName("minePoints")[0].innerHTML=briscolaPlay.getResult()[briscolaPlay.myId];var a=document.getElementById("briscola");a.src=briscolaPlay.cardsPath+briscolaPlay.mixedCards[briscolaPlay.deckSize-1]+".jpg",briscolaPlay.briscolaCard=Math.floor(briscolaPlay.mixedCards[briscolaPlay.deckSize-1]/10);for(var b=!1,c=0,d=document.getElementsByClassName("computer"),e=0;e<d.length;e++)briscolaPlay.hisCards[e]>=0?(d[e].src=briscolaPlay.cardsPath+briscolaPlay.hisCards[e]+".jpg",d[e].addEventListener("click",playCardEventWrapper,!1),c++):(d[e].src="../static/briscola/media/pictures/pic.jpg",addClass(d[e],"addCard"),removeClass(d[e],"playCard"));for(var d=document.getElementsByClassName("player"),f=0,e=0;e<d.length;e++)briscolaPlay.mineCards[e]>=0?(d[e].src=briscolaPlay.cardsPath+briscolaPlay.mineCards[e]+".jpg",d[e].addEventListener("click",playCardEventWrapper,!1),f++,addClass(d[e],"playCard")):(d[e].src="../static/briscola/media/pictures/pic.jpg",addClass(d[e],"addCard"),removeClass(d[e],"playCard"));c>f&&(b=!0);for(var d=document.getElementsByClassName("throwingTable"),e=0;e<d.length;e++)briscolaPlay.cardsOnTable[e]>=0&&(d[e].src=briscolaPlay.cardsPath+briscolaPlay.cardsOnTable[e]+".jpg",addClass(d[e],"thrown"),removeClass(d[e],"firstEmptySpace"));b&&(briscolaPlay.myTurn=0,briscolaPlay.onTurn=!1,playTurn("computer",-1)),briscolaPlay.onTurn!==!0&&(playTurn("computer",-1),briscolaPlay.onTurn=!0)},startNewGame=function(){var a=document.getElementById("briscola");a.src=briscolaPlay.cardsPath+briscolaPlay.mixedCards[briscolaPlay.deckSize-1]+".jpg",briscolaPlay.briscolaCard=Math.floor(briscolaPlay.mixedCards[briscolaPlay.deckSize-1]/10);for(var b=document.getElementsByClassName("computer playCard"),c=0;c<b.length;c++)b[c].src=briscolaPlay.cardsPath+briscolaPlay.mixedCards[c]+".jpg",briscolaPlay.hisCards[c]=briscolaPlay.mixedCards[c],briscolaPlay.setCardsLeft(briscolaPlay.cardsLeft-1);for(var b=document.getElementsByClassName("player playCard"),c=0;c<b.length;c++)b[c].src=briscolaPlay.cardsPath+briscolaPlay.mixedCards[briscolaPlay.deckSize-briscolaPlay.cardsLeft]+".jpg",briscolaPlay.mineCards[c]=briscolaPlay.mixedCards[briscolaPlay.deckSize-briscolaPlay.cardsLeft],briscolaPlay.setCardsLeft(briscolaPlay.cardsLeft-1),b[c].addEventListener("click",playCardEventWrapper,!1)},onCloseTabWindowEvent=function(){if(localStorage.setObj("briscolaPlay",briscolaPlay),localStorage.setObj("start",!1),0==briscolaPlay.cardsLeft){var a=localStorage.getItem("user");localStorage.clear(),localStorage.setItem("user",a)}},waitAbitPopup=function(){window.location="#popup1"},loadjscssfile("briscola/javaScript/classFunctions.js","js");var briscolaPlay=new BriscolaPlay;document.onreadystatechange=function(){window.onbeforeunload=function(){onCloseTabWindowEvent()},user=document.getElementsByClassName("playerName")[0].innerHTML,"complete"==document.readyState&&(localStorage.getObj("start")===!0||null==localStorage.getObj("start")||null===localStorage.getItem("briscolaPlay")?(startNewGame(),localStorage.setObj("start",!1)):(continueGame(),console.log("start old game")))};